name: deploy manual ðŸš€

on:
  workflow_dispatch:
    inputs:
      perform_deploy:
        description: 'Do you want to deploy?'
        required: true
        default: 'false'
        type: boolean

jobs:
  deploy-to-wp:
    runs-on: ubuntu-latest
    if: ${{ inputs.perform_deploy }}
    environment:
      name: 'production'
      url: ${{ steps.ftp-deploy.outputs.server }}

    env:
      WORDPRESS_HREF: '/festival/'

    steps:
      - name: Download artifact from build job
        uses: actions/download-artifact@v4
        with:
          name: node-app
          path: dist

      - name: Modify href in index.html
        run: |
          sed -i "s|<base href=['\"].*['\"]>|<base href='${WORDPRESS_HREF}'>|" dist/index.html

      - name: ðŸ“‚ Sync to WordPress FTP
        id: ftp-deploy
        uses: SamKirkland/FTP-Deploy-Action@v4.3.5
        with:
          server: konfusius.org
          username: ${{ secrets.FTP_USERNAME }}
          password: ${{ secrets.FTP_PASSWORD }}
          local-dir: ./dist/
          server-dir: festival/
          dangerous-clean-slate: true
