<div>
  <kf-shift-manager-toolbar
    [(selectedFilters)]="selectedFields"
    [(keywordFilter)]="keywordFilter"
    [selectedYears]="scopeYears()"
    [actionsDisabled]="selectedOrders().length === 0"
    (scopeYearChange)="onScopeYearChange($event)"
    (orderStatusChange)="bulkUpdateStatus($event)"
  ></kf-shift-manager-toolbar>
  <div>
    <p-table
      #dt
      [value]="filteredOrders()"
      [paginator]="true"
      [rows]="10"
      [rowsPerPageOptions]="[10, 20, 50, 100]"
      [showCurrentPageReport]="true"
      currentPageReportTemplate="Zeigt {first} bis {last} von {totalRecords} Anmeldungen"
      [(selection)]="selectedOrders"
      [loading]="loading$ | async"
      (onPage)="onPageChange($event)"
      [globalFilterFields]="['billing.full_name', 'id']"
    >
      <ng-template pTemplate="header">
        <tr>
          <th style="width: 4rem">
            <p-tableHeaderCheckbox />
          </th>

          <th pSortableColumn="status">
            Status
            <p-sortIcon field="status" />
            <p-columnFilter
              field="status"
              matchMode="in"
              display="menu"
              type="text"
              [showMatchModes]="false"
              [showOperator]="false"
              [showAddButton]="false"
              [hideOnClear]="true"
            >
              <ng-template
                #filter
                pTemplate="filter"
                let-value
                let-filter="filterCallback"
              >
                <p-multiSelect
                  [ngModel]="value"
                  [options]="statuses"
                  placeholder="Status Filter"
                  (onChange)="filter($event.value)"
                  optionLabel="label"
                  optionValue="value"
                  [filter]="false"
                  [showToggleAll]="false"
                  display="chip"
                  variant="filled"
                  [style.width]="'100%'"
                >
                </p-multiSelect>
              </ng-template>
            </p-columnFilter>
          </th>
          <th pSortableColumn="billing.full_name">
            Name<p-sortIcon field="billing.full_name" />
          </th>
          <th>Schicht</th>
          <th>E-mail</th>
          <th>
            Kontaktp.
            <p-columnFilter
              field="billing.billing_invite"
              matchMode="in"
              display="menu"
              [showMatchModes]="false"
              [showOperator]="false"
              [showAddButton]="false"
              [showApplyButton]="false"
              [showClearButton]="false"
            >
              <ng-template
                #filter
                pTemplate="filter"
                let-value
                let-filter="filterCallback"
              >
                <p-listbox [ngModel]="value" [options]="contactPersons()">
                </p-listbox>
              </ng-template>
            </p-columnFilter>
          </th>
          <th>Ticket</th>
          <th>Preis</th>
          <th pSortableColumn="date_created">
            Datum<p-sortIcon field="date_created" />
          </th>
          <th pSortableColumn="id">ID<p-sortIcon field="id" /></th>
        </tr>
      </ng-template>

      <ng-template pTemplate="body" let-order>
        <tr>
          <td><p-tableCheckbox [value]="order" /></td>

          <td>
            <app-order-status
              class="status-cell"
              [orderStatus]="order.status"
            ></app-order-status>
          </td>
          <td [pTooltip]="order.billing.full_name" class="limited-cell">
            <span class="truncate-text">{{ order.billing.full_name }}</span>
          </td>
          <td [pTooltip]="findMainItem(order.line_items)" class="limited-cell">
            <span class="truncate-text">{{
              findMainItem(order.line_items)
            }}</span>
          </td>
          <td class="email-cell limited-cell" [pTooltip]="order.billing.email">
            <div class="relative-wrapper">
              <span class="truncate-text">{{ order.billing.email }}</span>
              <p-button
                icon="pi pi-copy"
                [text]="true"
                [rounded]="true"
                (onClick)="copyToClipboard(order.billing.email)"
                class="copy-btn"
              />
            </div>
          </td>
          <td>{{ order.billing.billing_invite }}</td>
          <td>{{ findCrossItem(order.line_items) }}</td>
          <td>{{ order.total | currency: 'EUR' }}</td>
          <td>{{ order.date_created | dateFormat }}</td>
          <td>{{ order.id }}</td>
        </tr>
      </ng-template>
      <ng-template pTemplate="footer">
        <tr>
          <td colspan="7"></td>
          <td>{{ pageSum() | currency: 'EUR' }}</td>
          <td></td>
          <td></td>
        </tr>
      </ng-template>
    </p-table>
  </div>
</div>
